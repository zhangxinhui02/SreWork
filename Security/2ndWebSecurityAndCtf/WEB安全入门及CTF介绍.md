# WEB安全入门及CTF介绍

既然要讲Web安全，首先介绍什么是安全，安全的本质是什么？引用《白帽子讲安全》里对安全的定义：**安全问题的本质就是信任问题**。举例来说，手机的密码锁屏，我们认为是安全的，因为我们信任手机厂商的安全措施，如果这个信任都没有的话，那么我们会认为这个手机是不安全的。

## web安全入门

`写在开头`

### 网络安全法

- [中华人民共和国网络安全法](http://www.npc.gov.cn/npc/xinwen/2016-11/07/content_2001605.htm)
- [网络产品安全漏洞管理规定](http://www.gov.cn/zhengce/zhengceku/2021-07/14/content_5624965.htm)
- [关键信息基础设施安全保护条例](http://www.gov.cn/zhengce/content/2021-08/17/content_5631671.htm)
- [中华人民共和国个人信息保护法](http://www.npc.gov.cn/npc/c30834/202108/a8c4e3672c74491a80b53a172bb753fe.shtml)
- [中华人民共和国数据安全法](http://www.npc.gov.cn/npc/c30834/202106/7c9af12f51334a73b56d7938f99a788a.shtml)

```
                        《刑法》第二百八十五条
【非法侵入计算机信息系统罪】违反国家规定，侵入国家事务、国防建设、尖端科学技术
领域的计算机信息系统的，处三年以下有期徒刑或者拘役。

【非法获取计算机信息系统数据、非法控制计算机信息系统罪】违反国家规定，侵入前款规
定以外的计算机信息系统或者采用其他技术手段，获取该计算机信息系统中存储、处理或者
传输的数据，或者对该计算机信息系统实施非法控制，情节严重的，处三年以下有期徒刑或
者拘役，并处或者单处罚金;情节特别严重的，处三年以上七年以下有期徒刑，并处罚金。

【提供侵入、非法控制计算机信息系统的程序、工具罪】提供专门用于侵入、非法控制计算
机信息系统的程序、工具，或者明知他人实施侵入、非法控制计算机信息系统的违法犯罪行
为而为其提供程序、工具，情节严重的，依照前款的规定处罚。

                      《治安管理处罚法》
 第二十九条　有下列行为之一的，处五日以下拘留；情节较重的，处五日以上十日以下拘留：
 （一）违反国家规定，侵入计算机信息系统，造成危害的；　　
 （二）违反国家规定，对计算机信息系统功能进行删除、修改、增加、干扰，造成计算
机信息系统不能正常运行的；　　
 （三）违反国家规定，对计算机信息系统中存储、处理、传输的数据和应用程序进行删
除、修改、增加的；　　
 （四）故意制作、传播计算机病毒等破坏性程序，影响计算机信息系统正常运行的。
 
                        《网络安全法》
第六十三条 第三款          
违反本法第二十七条规定，
			受到治安管理处罚的人员，五年内不得从事网络安全管理和网络运营关键岗位的工作；
			受到刑事处罚的人员，终身不得从事网络安全管理和网络运营关键岗位的工作。
```

![img](https://s2.loli.net/2021/12/11/Hlbi6uCvzwtKgAJ.jpg)

### 基础知识学习

#### 什么是WEB

Web（World Wide Web）即全球广域网，也称为万维网，它是一种基于超文本和HTTP的、全球性的、动态交互的、跨平台的分布式图形信息系统。是建立在Internet上的一种网络服务，为浏览者在Internet上查找和浏览信息提供了图形化的、易于访问的直观界面，其中的文档及超级链接将Internet上的信息节点组织成一个互为关联的网状结构。

web图解

![img](https://s2.loli.net/2021/12/11/8DmnspRXvaqfTLd.png)

#### http协议（复习）

##### http协议简介

超文本传输协议（英文：**H**yper**T**ext **T**ransfer **P**rotocol，缩写：HTTP）

> HTTP是一种能够获取如 HTML 这样的网络资源的通讯协议。 为 Web 浏览器与 Web 服务器之间的通信而设计的一种 client-server 协议。客户端和服务端之间通过交互各自的消息进行交互。

##### http协议实例(简化版)

![img](https://s2.loli.net/2021/12/11/opN2j4aHcQyeSYP.jpg)

抓个包

请求：

```http
POST / HTTP/1.1      //请求行
Host: www.baidu.com    //消息头键值对
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:80.0) Gecko/20100101 Firefox/80.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
//空白行，代表请求头结束
Username=admin&Password=admin //请求正文
```

第一行为**请求方法**，请求的**资源路径**和使用**HTTP协议版本**，

后面为**消息头键值对**，

紧接着为一个**空行**和需要发送的**内容**实体。

回应：

```http
HTTP/1.1 200 OK    //响应行
Server: nginx      //响应头键值对
Date: Thu, 15 Oct 2020 12:17:56 GMT
Last-Modified: Mon, 15 May 2017 18:04:40 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Vary: Accept-Encoding
Content-Length: 67556
//空白行，代表相应头结束
<!DOCTYPE html>     //消息主体
  <html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta content="always" name="referrer"><meta name="theme-color" content="#2932e1"><meta name="description" content="全球最大的中文搜索引擎、致力于让网民更便捷地获取信息，找到所求。百度超过千亿的中文网页数据库，可以瞬间找到相关的搜索结果。"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" /><link rel="search" type="application/opensearchdescription+xml" href="/content-search.xml" title="百度搜索" /><link rel="icon" sizes="any" mask href="//www.baidu.com/img/baidu_85beaf5496f291521eb75ba38eacbd87.svg"><link rel="dns-prefetch" href="//dss0.bdstatic.com"/><link rel="dns-prefetch" href="//dss1.bdstatic.com"/><link rel="dns-prefetch" href="//ss1.bdstatic.com"/><link rel="dns-prefetch" href="//sp0.baidu.com"/><link rel="dns-prefetch" href="//sp1.baidu.com"/><link rel="dns-prefetch" href="//sp2.baidu.com"/><title>百度一下，你就知道</title><style index="newi" type="text/css">............................................................................................
```

第一行为**协议版本号**、**状态号**和对应**状态信息**，

后面为**返回头**键值对，

紧接着为一个**空行**和返回的**内容**实体。

##### http工作流程简介

例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：

1. 浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;
2. 解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;
3. 浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;
4. 服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;
5. 释放 TCP连接;
6. 浏览器将该 html 文本并显示内容; 　

##### http请求方法

HTTP/1.1协议中共定义了八种方法（也叫“动作”）来以不同方式操作指定的资源：

- GET：向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据。

- POST：向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。
- HEAD：与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。

- PUT：向指定资源位置上传其最新内容。

- DELETE：请求服务器删除Request-URI所标识的资源。

- TRACE：回显服务器收到的请求，主要用于测试或诊断。

- OPTIONS：这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用'*'来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。

- CONNECT：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。通常用于SSL加密服务器的链接（经由非加密的HTTP代理服务器）。

注意事项：

1. 方法名称是区分大小写的。
2. 目前用的最多的是get和post

##### http状态码

简略版

状态代码的第一个数字代表当前响应的类型：

- 1xx消息——请求已被服务器接收，继续处理
- 2xx成功——请求已成功被服务器接收、理解、并接受
- 3xx重定向——需要后续操作才能完成这一请求
- 4xx请求错误——请求含有词法错误或者无法被执行
- 5xx服务器错误——服务器在处理某个正确请求时发生错误

这是通用标准，但是web开发者可以自定义

详细版  

| 状态码 | 状态码英文名称                  | 中文描述                                                     |
| :----- | :------------------------------ | :----------------------------------------------------------- |
| 100    | Continue                        | 继续。客户端应继续其请求                                     |
| 101    | Switching Protocols             | 切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到HTTP的新版本协议 |
|        |                                 |                                                              |
| 200    | OK                              | 请求成功。一般用于GET与POST请求                              |
| 201    | Created                         | 已创建。成功请求并创建了新的资源                             |
| 202    | Accepted                        | 已接受。已经接受请求，但未处理完成                           |
| 203    | Non-Authoritative Information   | 非授权信息。请求成功。但返回的meta信息不在原始的服务器，而是一个副本 |
| 204    | No Content                      | 无内容。服务器成功处理，但未返回内容。在未更新网页的情况下，可确保浏览器继续显示当前文档 |
| 205    | Reset Content                   | 重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域 |
| 206    | Partial Content                 | 部分内容。服务器成功处理了部分GET请求                        |
|        |                                 |                                                              |
| 300    | Multiple Choices                | 多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择 |
| 301    | Moved Permanently               | 永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替 |
| 302    | Found                           | 临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI |
| 303    | See Other                       | 查看其它地址。与301类似。使用GET和POST请求查看               |
| 304    | Not Modified                    | 未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源 |
| 305    | Use Proxy                       | 使用代理。所请求的资源必须通过代理访问                       |
| 306    | Unused                          | 已经被废弃的HTTP状态码                                       |
| 307    | Temporary Redirect              | 临时重定向。与302类似。使用GET请求重定向                     |
|        |                                 |                                                              |
| 400    | Bad Request                     | 客户端请求的语法错误，服务器无法理解                         |
| 401    | Unauthorized                    | 请求要求用户的身份认证                                       |
| 402    | Payment Required                | 保留，将来使用                                               |
| 403    | Forbidden                       | 服务器理解请求客户端的请求，但是拒绝执行此请求               |
| 404    | Not Found                       | 服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置"您所请求的资源无法找到"的个性页面 |
| 405    | Method Not Allowed              | 客户端请求中的方法被禁止                                     |
| 406    | Not Acceptable                  | 服务器无法根据客户端请求的内容特性完成请求                   |
| 407    | Proxy Authentication Required   | 请求要求代理的身份认证，与401类似，但请求者应当使用代理进行授权 |
| 408    | Request Time-out                | 服务器等待客户端发送的请求时间过长，超时                     |
| 409    | Conflict                        | 服务器完成客户端的 PUT 请求时可能返回此代码，服务器处理请求时发生了冲突 |
| 410    | Gone                            | 客户端请求的资源已经不存在。410不同于404，如果资源以前有现在被永久删除了可使用410代码，网站设计人员可通过301代码指定资源的新位置 |
| 411    | Length Required                 | 服务器无法处理客户端发送的不带Content-Length的请求信息       |
| 412    | Precondition Failed             | 客户端请求信息的先决条件错误                                 |
| 413    | Request Entity Too Large        | 由于请求的实体过大，服务器无法处理，因此拒绝请求。为防止客户端的连续请求，服务器可能会关闭连接。如果只是服务器暂时无法处理，则会包含一个Retry-After的响应信息 |
| 414    | Request-URI Too Large           | 请求的URI过长（URI通常为网址），服务器无法处理               |
| 415    | Unsupported Media Type          | 服务器无法处理请求附带的媒体格式                             |
| 416    | Requested range not satisfiable | 客户端请求的范围无效                                         |
| 417    | Expectation Failed              | 服务器无法满足Expect的请求头信息                             |
|        |                                 |                                                              |
| 500    | Internal Server Error           | 服务器内部错误，无法完成请求                                 |
| 501    | Not Implemented                 | 服务器不支持请求的功能，无法完成请求                         |
| 502    | Bad Gateway                     | 作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应 |
| 503    | Service Unavailable             | 由于超载或系统维护，服务器暂时的无法处理客户端的请求。延时的长度可包含在服务器的Retry-After头信息中 |
| 504    | Gateway Time-out                | 充当网关或代理的服务器，未及时从远端服务器获取请求           |
| 505    | HTTP Version not supported      |                                                              |

##### url

超文本传输协议（HTTP）的统一资源定位符将从因特网获取信息的五个基本元素包括在一个简单的地址中：

- 传送协议。
- 层级URL标记符号(为[//],固定不变)
- 服务器。（通常为域名，有时为IP地址）
- 端口号。（以数字方式表示，若为HTTP的默认值“:80”可省略）
- 路径。（以“/”字符区别路径中的每一个目录名称）
- 查询。（GET模式的窗体参数，以“?”字符为起点，每个参数以“&”隔开，再以“=”分开参数名称与数据，通常以UTF8的URL编码，避开字符冲突的问题）
- 片段。以“#”字符为起点

例子：

http://www.redrock.com:80/news/index.html?id=250

http，是协议；
www.redrock.com，是服务器；
:80，是服务器上的默认网络端口号，默认不显示；
/news/index.html，是路径（URI：直接定位到对应的资源）；
?id=250，是查询参数。
大多数网页浏览器不要求用户输入网页中“http://”的部分，因为绝大多数网页内容是超文本传输协议文件。同样，“80”是超文本传输协议文件的常用端口号，因此一般也不必写明。一般来说用户只要键入统一资源定位符的一部分（www.redrock.com:80/news/index.html?id=250）就可以了。

由于超文本传输协议允许服务器将浏览器重定向到另一个网页地址，因此许多服务器允许用户省略网页地址中的部分，比如 www。从技术上来说这样省略后的网页地址实际上是一个不同的网页地址，浏览器本身无法决定这个新地址是否通，服务器必须完成重定向的任务。

完整的url结构

![Cache_502f78aa8a11636e](https://s2.loli.net/2021/12/14/ERsWc8J63pHwXSh.jpg)

##### cookie和session

HTTP是一种不保存状态,即无状态(stateless)协议。HTTP协议 自身不对请求和响应之间的通信状态进行保存。也就是说在HTTP这个 级别,协议对于发送过的请求或响应都不做持久化处理。

协议本身不保留之前的一切信息

可是,随着Web的不断发展,因无状态而导致业务处理变得棘手 的情况增多了。

比如，购物网站。

因此引入了cookie

Cookie 是一段随着HTTP请求、响应一起被传递的额外数据，他的主要作用是标识用户、维持会话。储存在客户端

例

```http
Cookie: BAIDUID=1F5C5CF07C6E549A0B4B52A4748DF67A; BIDUPSID=1F5C5CF07C6E549A032440EB9889BB88; PSTM=1600271688; COOKIE_SESSION=4576_0_3_0_35_9_0_0_0_3_28801_0_4545_0_2_0_1600318308_0_1600318306%7C6%230_0_1600318306%7C1; BD_HOME=1; H_PS_PSSID=32818_1453_31660_32723_32230_7517_32116_32761_22160
```

session和cookie差不多，session储存在服务器端，这当然会增加服务器的压力，但是这比cookie会稍微安全一点点，就一点点，作为（~~黑客~~）web安全学习路上的你想想这是为什么？

#####  HTTPS

HTTP：建立在  TCP（传输层）  上的    HTTP（应用层）

HTTPS：在TCP（传输层）  与    HTTP（应用层）中间增加了一个安全套接层SSL/TLS

HTTPS的作用：

- 内容加密 建立一个信息安全通道，来保证数据传输的安全；
- 身份认证 确认网站的真实性
- 数据完整性 防止内容被第三方冒充或者篡改

https仅仅只是比http更安全而已！

#### 前端与后端

##### 前端

前端就是你在浏览器上看到的界面

一般涉及到这三门语言：[HTML](https://www.runoob.com/html/html-tutorial.html),[CSS](https://www.runoob.com/css/css-tutorial.html),[JavaScript](https://www.runoob.com/js/js-tutorial.html)

HTML就是界面内容，相当于一坨橡皮泥

CSS用于控制界面排版，它能将这坨橡皮泥捏的好看点

JavaScript用于控制界面行为，他能让橡皮泥动起来

web安全入门对前端语言的要求并不高，能看懂就行，其中重要程度JavaScript>HTML>css

##### 后端

后端就是一个部署到服务器上的一个程序

涉及到的语言：PHP，Python，Nodejs，java……（编程语言不分好坏，相当于什么场合用什么语言）

这其中我们暂时需要重点掌握php（下节web安全课会讲）

后端相当于一个商店，想要什么问他们要（请求），给钱（协议），他们就会给你什么（回应）

#### 数据库

顾名思义就是存放数据的一个地方

常见数据库：Mysql，Oracle，MongoDB，mssql（SQLServer）……

数据库相当于你家的储物柜

暂时我们需要掌握mysql（运维方向第一节课）

#### 服务器

一台十分牛逼的电脑，上面可以运行后端服务

#### IP地址与端口

##### ip地址

它就是你在web中的地址，别人可以通过你的ip地址找到你在web中的位置（在计网基础已经详细讲过，这里不再详解）

##### 端口（ port）

可以认为这是设备与外界通讯交流的出口，我们web中所说端口通常是虚拟端口，也就是我们常说的80端口，22端口等等

我们把中心食堂当作一个主机，那么每一个打饭的窗口都是一个端口。这个窗口早上卖包子、豆浆等等，端口也可以有不同的服务。

端口的分类根据其参考对象不同有不同划分方法，如果从端口的性质来分，通常可以分为以下三类：

- 公认端口（Well Known Ports）：这类端口也常称之为"常用端口"。这类端口的端口号从0到1024，它们紧密绑定于一些特定的服务。通常这些端口的通信明确表明了某种服务的协议­，这种端口是不可再重新定义它的作用对象。例如：80端口实际上总是HTTP通信所使用的，而23号端口则是Telnet服务专用的。

- 注册端口（Registered Ports）：端口号从1025到49151。它们松散地绑定于一些服务。也是说有许多服务绑定于这些端口，这些端口同样用于许多其他目的。这些端口多数没有明­确的定义服务对象，不同程序可根据实际需要自己定义，

- 动态和/或私有端口（Dynamic and/or Private Ports）：端口号从49152到65535。理论上，不应把常用服务分配在这些端口上。实际上，有些较为特殊的程序，特别是一些木马程序就非常喜欢用这些端­口，因为这些端口常常不被引起注意，容易隐蔽。

如果根据所提供的服务方式的不同，端口又可分为"TCP协议端口"和"UDP协议端口"两种。

前面所介绍的"连­接方式"是一种直接与接收方进行的连接，发送信息以后，可以确认信息是否到达，这种方式大多采用TCP协议；

另一种是不是直接与接收方进行连接，只管把信息放在­网上发出去，而不管信息是否到达，也就是前面所介绍的"无连接方式"。这种方式大多采用UDP协议。

对应使用以上这两种通信协议的­服务所提供的端口，也就分为"TCP协议端口"和"UDP协议端口"。

#### 防火墙

一个保护web应用安全的软件或者硬件，类似校门的保安叔叔，对进出的人群（流量）进行检查拦截等等

### 常见的基础web漏洞

#### sql注入

SQL注入漏洞是由于Web应用程序没有对用户输入数据的合法性进行判断，攻击者通过Web页面的输入区域(如URL、表单等) ，用精心构造的SQL语句插入特殊字符和指令，通过和**数据库**交互获得私密信息或者篡改数据库信息。

SQL注入攻击在Web攻击中非常流行，攻击者可以利用SQL注入漏洞获得管理员权限，在网页上加挂木马和各种恶意程序，盗取企业和用户敏感信息。

#### XSS

跨站脚本攻击（Cross-site scripting，通常简称为XSS）发生在客户端，可被用于进行窃取隐私、钓鱼欺骗、窃取密码、传播恶意代码等攻击。
XSS攻击使用到的技术主要为HTML和Javascript，也包括VBScript和ActionScript等。XSS攻击对WEB服务器虽无直接危害，但是它借助网站进行传播，使网站的使用用户受到攻击，导致网站用户帐号被窃取，从而对网站也产生了较严重的危害。

#### 弱口令

弱口令(weak password) 没有严格和准确的定义，通常认为容易被别人（他们有可能对你进行了社工）猜测到或被破解工具破解的口令均为弱口令。

#### 文件上传

文件上传漏洞通常由于网页代码中的文件上传路径变量过滤不严造成的，如果文件上传功能实现代码没有严格限制用户上传的文件后缀以及文件类型，攻击者可通过 Web 访问的目录上传任意文件，包括网站后门文件（webshell），进而远程控制网站服务器。

#### 文件包含

#### XXE

#### SSTI

#### SSRF

#### 反序列化漏洞

### web安全工具简单讲解

每种工具暂时仅列出一种

|               功能               |        例         |
| :------------------------------: | :---------------: |
|         **端口扫描工具**         |     **nmap**      |
|         **目录扫描工具**         |   **Dirsearch**   |
|        **shell连接工具**         |   **AntSword**    |
|         **sql注入工具**          |    **SQLMAP**     |
|         **ssrf利用工具**         |   **Gopherus**    |
|      **Google Chrome插件**       |    **HackBar**    |
|       **Git文件泄漏检测**        |    **Githack**    |
|           **端口爆破**           |     **hydra**     |
| **渗透测试，内网渗透，提权工具** | **Cobalt Strike** |

[web安全学习手册](https://websec.readthedocs.io/zh/latest/basic/index.html)

## [ctf介绍](file://D:\日常工作\红岩\2021暑假\2021课程准备\2\参考资料 \CTF入门指南.pptx)

一个[ctf学习网站](https://www.ctfhub.com/)

[另一个](https://ctf-wiki.org/)